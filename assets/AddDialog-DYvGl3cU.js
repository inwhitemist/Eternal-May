import{c as A,r as l,j as e,a as k,C as O,b as q,R as F,B as v,I as z,T as $,d as B,e as I,X as E,S as P,u as V,D as _}from"./index-DPLIgXdU.js";import{C as Y}from"./chevron-down-BIt3CnwR.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=A("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=A("WandSparkles",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]),X=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],J=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"];function U(s){const c=s.getFullYear(),h=String(s.getMonth()+1).padStart(2,"0"),o=String(s.getDate()).padStart(2,"0");return`${c}-${h}-${o}`}function Q(s,c){let o=new Date(s,c,1).getDay()-1;o<0&&(o=6);const p=new Date(s,c,1-o),x=[];for(let g=0;g<42;g++){const i=new Date(p);i.setDate(p.getDate()+g),x.push({d:i,inMonth:i.getMonth()===c})}return x}function Z({value:s,onChange:c,className:h}){const[o,p]=l.useState(!1),x=l.useMemo(()=>{const t=new Date(s);return isNaN(t.getTime())?new Date:t},[s]),[g,i]=l.useState(x.getFullYear()),[f,d]=l.useState(x.getMonth()),b=l.useRef(null);l.useEffect(()=>{o&&(i(x.getFullYear()),d(x.getMonth()))},[o,x]),l.useEffect(()=>{if(!o)return;function t(n){b.current&&(b.current.contains(n.target)||p(!1))}function r(n){n.key==="Escape"&&p(!1)}return document.addEventListener("mousedown",t),document.addEventListener("keydown",r),()=>{document.removeEventListener("mousedown",t),document.removeEventListener("keydown",r)}},[o]);const N=l.useMemo(()=>Q(g,f),[g,f]),D=U(new Date),y=new Date().getFullYear(),S=l.useMemo(()=>{const r=y+20,n=[];for(let m=1900;m<=r;m++)n.push(m);return n},[y]);return e.jsxs("div",{className:k("relative",h),ref:b,children:[e.jsx("button",{type:"button",onClick:()=>p(t=>!t),className:k("w-full rounded-xl border border-black/10 dark:border-white/10 bg-white/80 dark:bg-white/5 px-3 py-2 text-sm text-left","focus:outline-none focus:ring-2 focus:ring-indigo-400/60"),"aria-haspopup":"dialog","aria-expanded":o,children:new Date(s).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"})}),o&&e.jsxs("div",{className:"absolute z-10 mt-2 w-[22rem] rounded-2xl border border-black/10 bg-white/95 p-3 shadow-2xl backdrop-blur dark:border-white/10 dark:bg-neutral-900/95",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 px-1 pb-2",children:[e.jsx("button",{type:"button",className:"rounded-xl p-1.5 hover:bg-black/5 dark:hover:bg-white/10",onClick:()=>{let t=f-1,r=g;t<0&&(t=11,r-=1),d(t),i(r)},"aria-label":"Предыдущий месяц",children:e.jsx(O,{size:18})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("select",{className:k("appearance-none rounded-xl border border-black/10 bg-white px-3 py-2 pr-8 text-sm text-neutral-900 shadow-sm","focus:outline-none focus:ring-2 focus:ring-indigo-400/60","dark:border-white/10 dark:bg-neutral-900 dark:text-white"),value:f,onChange:t=>d(Number(t.target.value)),children:X.map((t,r)=>e.jsx("option",{value:r,children:t},t))}),e.jsx(Y,{size:16,className:"pointer-events-none absolute right-2 top-1/2 -translate-y-1/2 text-neutral-500 dark:text-neutral-400"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{className:k("appearance-none rounded-xl border border-black/10 bg-white px-3 py-2 pr-8 text-sm text-neutral-900 shadow-sm","focus:outline-none focus:ring-2 focus:ring-indigo-400/60","dark:border-white/10 dark:bg-neutral-900 dark:text-white"),value:g,onChange:t=>i(Number(t.target.value)),children:S.map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsx(Y,{size:16,className:"pointer-events-none absolute right-2 top-1/2 -translate-y-1/2 text-neutral-500 dark:text-neutral-400"})]})]}),e.jsx("button",{type:"button",className:"rounded-xl p-1.5 hover:bg-black/5 dark:hover:bg-white/10",onClick:()=>{let t=f+1,r=g;t>11&&(t=0,r+=1),d(t),i(r)},"aria-label":"Следующий месяц",children:e.jsx(q,{size:18})})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 px-1 text-center text-xs opacity-70 select-none",children:J.map(t=>e.jsx("div",{className:"py-1",children:t},t))}),e.jsx("div",{className:"mt-1 grid grid-cols-7 gap-1",children:N.map(({d:t,inMonth:r})=>{const n=U(t),m=n===s,C=n===D;return e.jsx("button",{type:"button",onClick:()=>{c(n),p(!1)},className:k("h-9 rounded-xl text-sm transition",r?"":"opacity-50",m?"bg-indigo-500 text-white shadow":"hover:bg-black/5 dark:hover:bg-white/10"),"aria-current":C?"date":void 0,title:t.toLocaleDateString("ru-RU"),children:t.getDate()},n+String(r))})}),e.jsxs("div",{className:"mt-3 flex items-center justify-between px-1",children:[e.jsx("button",{type:"button",className:"text-xs rounded-lg px-2 py-1 hover:bg-black/5 dark:hover:bg-white/10",onClick:()=>{const t=new Date;i(t.getFullYear()),d(t.getMonth())},children:"Сегодня"}),e.jsx("button",{type:"button",className:"text-xs rounded-lg px-2 py-1 hover:bg-black/5 dark:hover:bg-white/10",onClick:()=>p(!1),children:"Закрыть"})]})]})]})}function ee({initial:s,onSubmit:c,onCancel:h}){const[o,p]=l.useState((s==null?void 0:s.date)||new Date().toISOString().slice(0,10)),[x,g]=l.useState((s==null?void 0:s.title)||""),[i,f]=l.useState((s==null?void 0:s.description)||""),[d,b]=l.useState((s==null?void 0:s.tags)||[]),[N,D]=l.useState(""),[y,S]=l.useState((s==null?void 0:s.color)||""),[t,r]=l.useState(s==null?void 0:s.imageData),[n,m]=l.useState(!!(s!=null&&s.code)),[C,W]=l.useState((s==null?void 0:s.code)||"");F.useEffect(()=>{n?d.includes("legendary")||b(a=>[...a,"legendary"]):d.includes("legendary")&&b(a=>a.filter(u=>u!=="legendary"))},[n]);function L(){const a=N.trim();a&&(d.includes(a)||b([...d,a]),D(""))}function H(a){var w;const u=(w=a.target.files)==null?void 0:w[0];if(!u)return;if(!u.type.startsWith("image/"))return alert("Выберите изображение");const j=new FileReader;j.onload=()=>r(String(j.result)),j.readAsDataURL(u)}return F.useEffect(()=>{function a(u){var w;const j=(w=u.clipboardData)==null?void 0:w.items;if(j){for(const R of j)if(R.type.startsWith("image/")){const T=R.getAsFile();if(T){u.preventDefault();const M=new FileReader;M.onload=()=>r(String(M.result)),M.readAsDataURL(T)}break}}}return window.addEventListener("paste",a),()=>window.removeEventListener("paste",a)},[]),e.jsxs("form",{onSubmit:a=>{a.preventDefault();const u={id:(s==null?void 0:s.id)||V(),date:o,title:x.trim()||"Без названия",description:i.trim(),tags:d,color:y||void 0,imageData:t,...n?{code:C.trim().toUpperCase()}:{}};c(u)},className:"flex min-h-0 flex-1 flex-col",children:[e.jsxs("div",{className:"grid max-h-[60vh] gap-3 overflow-y-auto pr-1",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-black/60 dark:text-white/60",children:"Тип события"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{type:"button",variant:n?"soft":"primary",onClick:()=>m(!1),children:"Обычное"}),e.jsx(v,{type:"button",variant:n?"primary":"soft",onClick:()=>m(!0),children:"Легендарное"})]})]}),n&&e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-black/60 dark:text-white/60",children:"Код"}),e.jsx(z,{value:C,onChange:a=>W(a.target.value),required:!0})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-black/60 dark:text-white/60",children:"Дата"}),e.jsx("input",{type:"date",value:o,onChange:()=>{},required:!0,className:"sr-only pointer-events-none opacity-0 absolute -z-10",tabIndex:-1,readOnly:!0}),e.jsx(Z,{value:o,onChange:p})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-black/60 dark:text-white/60",children:"Заголовок"}),e.jsx(z,{value:x,onChange:a=>g(a.target.value),placeholder:"Например: Переезд в новый город"})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-black/60 dark:text-white/60",children:"Описание"}),e.jsx($,{rows:4,value:i,onChange:a=>f(a.target.value),placeholder:"Короткая история/заметки"})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-black/60 dark:text-white/60",children:"Теги"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(z,{value:N,onChange:a=>D(a.target.value),placeholder:"Добавить тег",onKeyDown:a=>a.key==="Enter"&&(a.preventDefault(),L())}),e.jsxs(v,{variant:"soft",onClick:L,type:"button",children:[e.jsx(G,{size:16})," Добавить"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 pt-1",children:d.map(a=>e.jsx(B,{label:a,onClick:()=>a==="legendary"&&n?void 0:b(d.filter(u=>u!==a))},a))})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx("label",{className:"text-xs text-black/60 dark:text-white/60",children:"Цвет акцента"}),e.jsx("div",{className:"flex flex-wrap items-center gap-3",children:["#60a5fa","#34d399","#f472b6","#fb923c","#a78bfa","#fbbf24"].map(a=>e.jsx("button",{type:"button",onClick:()=>S(a),className:k("h-6 w-6 rounded-full border border-black/20 dark:border-white/10",y===a&&"ring-2 ring-offset-2 ring-indigo-400"),style:{background:a},"aria-label":`Выбрать цвет ${a}`},a))})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("label",{className:"text-xs text-black/60 dark:text-white/60 flex items-center gap-2",children:[e.jsx(I,{size:16})," Фото (необязательно, 1 шт; можно вставить из буфера обмена)"]}),e.jsxs("div",{className:"flex flex-col items-start gap-2",children:[e.jsxs("label",{className:k("relative flex cursor-pointer items-center justify-center rounded-xl border-2 border-dashed border-indigo-300/60 bg-white/60 px-4 py-4 text-sm font-medium transition hover:bg-indigo-50 dark:bg-white/10 dark:hover:bg-indigo-950/20",t&&"border-solid border-indigo-400 bg-indigo-50/60 dark:bg-indigo-900/30"),style:{minHeight:120,minWidth:180,width:"100%",maxWidth:320},children:[t?e.jsx("img",{src:t,alt:"Превью",className:"max-h-28 max-w-full object-contain rounded-lg shadow"}):e.jsxs("div",{className:"flex flex-col items-center justify-center w-full h-full gap-2 py-2 text-indigo-500 dark:text-indigo-300",children:[e.jsx(I,{size:32}),e.jsx("span",{className:"text-xs opacity-70",children:"Выбрать изображение"})]}),e.jsx("input",{type:"file",accept:"image/*",onChange:H,className:"absolute inset-0 h-full w-full opacity-0 cursor-pointer",tabIndex:-1,"aria-label":"Выбрать изображение"})]}),t&&e.jsxs(v,{variant:"outline",className:"mt-1",onClick:()=>r(void 0),type:"button",children:[e.jsx(E,{size:14})," Удалить фото"]})]})]})]}),e.jsxs("div",{className:"sticky bottom-0 -mx-4 mt-3 flex justify-end gap-2 border-t border-black/10 bg-white/90 px-4 py-3 backdrop-blur dark:border-white/10 dark:bg-neutral-900/90 rounded-b-2xl",children:[e.jsxs(v,{variant:"outline",onClick:h,type:"button",children:[e.jsx(E,{size:16})," Отмена"]}),e.jsxs(v,{type:"submit",children:[e.jsx(P,{size:16})," Сохранить"]})]})]})}function ae({open:s,initial:c,onClose:h,onSubmit:o}){return e.jsxs(_,{open:s,onClose:h,children:[e.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between gap-3 border-b border-black/10 bg-white/95 px-4 py-3 dark:border-white/10 dark:bg-neutral-900/95 rounded-t-2xl",children:[e.jsxs("div",{className:"flex items-center gap-2 text-lg font-semibold",children:[e.jsx(K,{size:18})," ",c?"Редактировать событие":"Новое событие"]}),e.jsx(v,{variant:"ghost",onClick:h,children:e.jsx(E,{size:18})})]}),e.jsx("div",{className:"px-4",children:e.jsx(ee,{initial:c||void 0,onCancel:h,onSubmit:o})})]})}export{ae as default};
