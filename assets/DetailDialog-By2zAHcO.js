import{c as C,R as l,f as R,j as e,D as A,B as h,X as L,g as P,h as B,M as F,i as H,P as U,k as V}from"./index-CO7rDMHh.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=C("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=C("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),_=c=>c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");function J({open:c,event:a,admin:I,onClose:m,onEdit:z,onDelete:E,onImagePreview:p}){var y;const[d,u]=l.useState(null),[b,f]=l.useState(null),[k,j]=l.useState(!1),[w,N]=l.useState(!1);l.useEffect(()=>{let t=!1;if(u(null),f(null),!!(a!=null&&a.chatId))return j(!0),R.getChatMessages(a.chatId,a.chatFromId??void 0,a.chatToId??void 0).then(s=>{t||u(s.messages||[])}).catch(s=>{t||f((s==null?void 0:s.message)||"Не удалось загрузить переписку")}).finally(()=>{t||j(!1)}),()=>{t=!0}},[a==null?void 0:a.chatId,a==null?void 0:a.chatFromId,a==null?void 0:a.chatToId]),l.useEffect(()=>{N(!!(a!=null&&a.chatId))},[a==null?void 0:a.chatId]);const M=l.useCallback(t=>{const s=t.match(/(https?:\/\/\S+\.(?:png|jpe?g|gif|webp)(?:\?\S*)?)/gi);return s?s.map(r=>r.trim()):[]},[]),S=l.useCallback((t,s)=>{if(!s.length)return t.trim();let r=t;return s.forEach(i=>{const g=new RegExp(`(?:\\s*Фотография:?\\s*)?${_(i)}`,"gi");r=r.replace(g," ")}),r.replace(/ {2,}/g," ").trim()},[]),o=l.useMemo(()=>[{tint:"rgba(99, 102, 241, 0.08)",border:"rgba(99, 102, 241, 0.25)",accent:"rgba(99, 102, 241, 0.4)"},{tint:"rgba(16, 185, 129, 0.08)",border:"rgba(16, 185, 129, 0.25)",accent:"rgba(16, 185, 129, 0.45)"},{tint:"rgba(14, 165, 233, 0.08)",border:"rgba(14, 165, 233, 0.25)",accent:"rgba(14, 165, 233, 0.4)"},{tint:"rgba(249, 115, 22, 0.08)",border:"rgba(249, 115, 22, 0.25)",accent:"rgba(249, 115, 22, 0.4)"},{tint:"rgba(244, 114, 182, 0.08)",border:"rgba(244, 114, 182, 0.25)",accent:"rgba(244, 114, 182, 0.4)"},{tint:"rgba(163, 230, 53, 0.08)",border:"rgba(163, 230, 53, 0.25)",accent:"rgba(163, 230, 53, 0.45)"},{tint:"rgba(248, 113, 113, 0.08)",border:"rgba(248, 113, 113, 0.25)",accent:"rgba(248, 113, 113, 0.4)"},{tint:"rgba(59, 130, 246, 0.08)",border:"rgba(59, 130, 246, 0.25)",accent:"rgba(59, 130, 246, 0.4)"}],[]);return l.useCallback(t=>{if(!t)return o[0];let s=0;for(let i=0;i<t.length;i+=1)s=s*31+t.charCodeAt(i)|0;const r=Math.abs(s)%o.length;return o[r]},[o]),!c||!a?null:e.jsxs(A,{open:c,onClose:m,children:[e.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between gap-3 border-b border-black/10 bg-white/95 px-4 py-3 dark:border-white/10 dark:bg-neutral-900/95 rounded-t-2xl",children:[e.jsxs("div",{className:"flex items-center gap-2 text-lg font-semibold",children:[e.jsx(X,{size:18})," ",a.title]}),e.jsx(h,{variant:"ghost",onClick:m,children:e.jsx(L,{size:18})})]}),e.jsxs("div",{className:"flex max-h-[85vh] flex-col gap-3 overflow-y-auto p-4",children:[e.jsxs("div",{className:"text-sm opacity-80",children:[e.jsx(B,{className:"-mt-0.5 inline",size:14})," ",P(a.date)]}),a.imageData&&e.jsx("div",{className:"overflow-hidden rounded-2xl border border-black/10 dark:border-white/10 flex-shrink-0",children:e.jsx("img",{src:a.imageData,alt:a.title,className:"max-h-[30vh] w-full cursor-pointer object-contain",onClick:()=>p(a.imageData)})}),a.description&&e.jsx("p",{className:"text-sm leading-relaxed text-neutral-800 dark:text-neutral-200 whitespace-pre-line",children:a.description}),(y=a.tags)!=null&&y.length?e.jsx("div",{className:"flex flex-wrap gap-2",children:a.tags.map(t=>e.jsxs("span",{className:"rounded-full border border-black/10 bg-black/5 px-2 py-0.5 text-xs dark:border-white/10 dark:bg-white/10",children:["#",t==="legendary"?"легендарное":t]},t))}):null,a.chatId&&e.jsxs("div",{className:"rounded-2xl border border-emerald-500/30 bg-emerald-500/5 p-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-emerald-700 dark:text-emerald-200",children:[e.jsx(F,{size:16})," Переписка"]}),e.jsx(h,{variant:"ghost",className:"px-3 py-1 text-xs",onClick:()=>N(t=>!t),children:w?"Скрыть":"Показать"})]}),w?e.jsxs("div",{className:"mt-3 grid gap-2",children:[k&&e.jsx("div",{className:"text-sm text-black/60 dark:text-white/60",children:"Загрузка переписки…"}),b&&e.jsx("div",{className:"text-sm text-red-500",children:b}),!k&&!b&&e.jsx("div",{className:"flex flex-col gap-3",children:d!=null&&d.length?d.map(t=>{const s=M(t.text),r=S(t.text,s),i="1 прикреплённое сообщение",g=r.includes(i),$=r==="Стикер",D=(s.length,"border-black/5 bg-white/95 dark:border-white/10 dark:bg-neutral-900/70");return e.jsxs("div",{className:`rounded-2xl border px-4 py-3 text-sm shadow-sm backdrop-blur-sm transition hover:shadow-md ${D}`,children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 text-xs text-black/60 dark:text-white/60",children:[e.jsx("span",{className:"font-semibold text-black dark:text-white",children:t.author}),e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-black/5 px-2 py-0.5 text-[11px] font-normal text-black/60 dark:bg-white/10 dark:text-white/70",children:[e.jsx(q,{size:12,className:"opacity-70"}),H(t.datetime)]})]}),r&&e.jsx("p",{className:`mt-2 whitespace-pre-line text-[15px] leading-relaxed ${$?"text-black/40 dark:text-white/40 italic":"text-black/80 dark:text-white/80"}`,children:g?r.split(i).map((n,x,T)=>e.jsxs(l.Fragment,{children:[n,x<T.length-1&&e.jsx("span",{className:"text-black/40 dark:text-white/40",children:i})]},`${t.id}-chunk-${x}`)):r}),s.length>0&&e.jsx("div",{className:"mt-3 grid gap-3 sm:grid-cols-2",children:s.map((n,x)=>e.jsxs("button",{type:"button",className:"group relative overflow-hidden rounded-2xl border border-emerald-500/20 bg-black/5 shadow-inner transition hover:border-emerald-500/40 focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500/50",onClick:()=>p(n),children:[e.jsx("img",{src:n,alt:"Фото из переписки",className:"h-44 w-full cursor-zoom-in object-cover transition duration-300 group-hover:scale-[1.03]",loading:"lazy"}),e.jsx("span",{className:"pointer-events-none absolute bottom-2 right-2 rounded-full bg-black/70 px-2 py-0.5 text-xs text-white opacity-0 transition group-hover:opacity-100",children:"Открыть"})]},`${t.id}-${x}`))})]},t.id)}):e.jsx("div",{className:"text-sm text-black/60 dark:text-white/60",children:"Сообщений в указанном диапазоне нет"})})]}):e.jsx("div",{className:"mt-3 text-sm text-black/60 dark:text-white/60",children:"Переписка скрыта"})]}),I&&e.jsxs("div",{className:"mt-2 flex items-center justify-end gap-2",children:[e.jsxs(h,{variant:"soft",onClick:()=>z(a),children:[e.jsx(U,{size:16})," Редактировать"]}),e.jsxs(h,{variant:"outline",onClick:()=>E(a),children:[e.jsx(V,{size:16})," Удалить"]})]})]})]})}export{J as default};
