import{c as k,r as i,j as e,h as F,B as r,L as X,S as K,a as Y,i as C,k as V,I as B,g as H,l as Z,m as _}from"./index-BZJw03TX.js";import{C as I}from"./chevron-down-BSxa8n3K.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S=k("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=k("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=k("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=k("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=k("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=k("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);function ie({authorized:o,onExit:f,onRequestLogin:d}){const[c,h]=i.useState("users");return i.useEffect(()=>{h("users")},[o]),o?e.jsx("div",{className:"min-h-[100svh] bg-gradient-to-b from-slate-50 to-white px-4 py-10 dark:from-neutral-900 dark:to-neutral-950",children:e.jsxs("div",{className:"mx-auto flex max-w-6xl flex-col gap-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"inline-flex items-center gap-2 rounded-full border border-black/10 bg-white/70 px-3 py-1 text-xs font-medium uppercase tracking-wide text-black/70 backdrop-blur dark:border-white/10 dark:bg-white/10 dark:text-white/70",children:[e.jsx(F,{size:14})," Secure Area"]}),e.jsx("h1",{className:"mt-3 text-3xl font-bold",children:"Админ-панель"}),e.jsx("p",{className:"text-black/60 dark:text-white/60",children:"Управляйте пользователями, кодами и легендарными событиями."})]}),e.jsx(r,{variant:"outline",onClick:f,children:"Вернуться к таймлайну"})]}),e.jsxs("div",{className:"rounded-3xl border border-black/5 bg-white/80 shadow-2xl shadow-purple-500/5 backdrop-blur dark:border-white/10 dark:bg-neutral-900/80",children:[e.jsxs("div",{className:"border-b border-black/5 px-4 pb-4 pt-6 dark:border-white/10",children:[e.jsx("div",{className:"flex flex-wrap items-center justify-between gap-3",children:e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(q,{size:18})," Контрольная панель"]})}),e.jsx("div",{className:"relative mt-4",children:e.jsxs("div",{className:"flex gap-2 rounded-xl bg-black/5 p-1 dark:bg-white/10",children:[e.jsxs(Q,{active:c==="users",onClick:()=>h("users"),children:[e.jsx(q,{size:16})," Пользователи"]}),e.jsxs(Q,{active:c==="legendary",onClick:()=>h("legendary"),children:[e.jsx(K,{size:16})," Легендарные события"]})]})})]}),e.jsx("div",{className:"p-4",children:c==="users"?e.jsx(se,{}):e.jsx(ae,{})})]})]})}):e.jsx("div",{className:"min-h-[100svh] bg-gradient-to-b from-slate-100 to-white px-4 py-10 dark:from-neutral-950 dark:to-neutral-900",children:e.jsxs("div",{className:"mx-auto flex min-h-[80svh] max-w-3xl flex-col items-center justify-center gap-6 text-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full border border-black/10 bg-white/70 px-4 py-1 text-sm backdrop-blur dark:border-white/10 dark:bg-white/10",children:[e.jsx(F,{size:16})," Доступ ограничен"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Эта страница только для админов"}),e.jsx("p",{className:"text-base text-black/70 dark:text-white/70",children:"Убедитесь, что вошли под админским аккаунтом. Если нужна помощь — свяжитесь с владельцем таймлайна."})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-3",children:[d&&e.jsxs(r,{onClick:d,children:[e.jsx(X,{size:16})," Войти"]}),e.jsx(r,{variant:"outline",onClick:f,children:"Вернуться к воспоминаниям"})]})]})})}function Q({active:o,onClick:f,children:d}){return e.jsx("button",{onClick:f,className:Y("flex items-center gap-2 rounded-lg px-3 py-1.5 text-sm transition",o?"bg-white shadow dark:bg-neutral-800":"hover:bg-black/10 dark:hover:bg-white/20"),children:d})}function se(){const[o,f]=i.useState([]),[d,c]=i.useState(!1),[h,x]=i.useState(null),[j,M]=i.useState(""),[u,y]=i.useState("all"),[m,z]=i.useState("email"),[g,a]=i.useState("asc"),[p,w]=i.useState({}),[$,R]=i.useState(null),[b,E]=i.useState(null);i.useEffect(()=>{N()},[]);async function N(){x(null),c(!0);try{const s=await C.getUsers();f(s.users)}catch(s){x((s==null?void 0:s.message)||"Не удалось загрузить пользователей")}finally{c(!1)}}async function A(s){const t=(p[s]||"").trim();if(!t)return;const l=Array.from(new Set(t.split(/[\s,;]+/g).map(n=>n.trim()).filter(Boolean)));if(l.length!==0){c(!0),x(null);try{for(const n of l)await C.grantLegendary(s,n);w(n=>({...n,[s]:""})),await N()}catch(n){x((n==null?void 0:n.message)||"Не удалось выдать код(ы)")}finally{c(!1)}}}async function J(s,t){c(!0),x(null);try{await C.revokeLegendary(s,t),await N()}catch(l){x((l==null?void 0:l.message)||"Не удалось отозвать код")}finally{c(!1),E(null)}}async function O(s,t){if(t.length!==0){c(!0),x(null);try{for(const l of t)await C.revokeLegendary(s,l);await N()}catch(l){x((l==null?void 0:l.message)||"Не удалось отозвать коды")}finally{c(!1)}}}function T(s){m===s?a(t=>t==="asc"?"desc":"asc"):(z(s),a("asc"))}const P=i.useMemo(()=>{const s=j.trim().toLowerCase();let t=o.filter(l=>{if(u!=="all"&&l.role!==u)return!1;if(!s)return!0;const n=l.email.toLowerCase().includes(s),v=l.codes.some(W=>W.toLowerCase().includes(s));return n||v||l.id.toLowerCase().includes(s)});return t.sort((l,n)=>{let v=0;return m==="email"?v=l.email.localeCompare(n.email):m==="role"?v=l.role.localeCompare(n.role):m==="codes"&&(v=l.codes.length-n.codes.length),g==="asc"?v:-v}),t},[o,j,u,m,g]);async function D(s,t){try{await navigator.clipboard.writeText(s),R(t),setTimeout(()=>R(l=>l===t?null:l),1200)}catch{}}return e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm opacity-60",children:[e.jsx(q,{size:16})," Управление пользователями"]}),e.jsxs(r,{variant:"soft",onClick:N,disabled:d,children:[e.jsx(G,{className:d?"animate-spin":"",size:16})," Обновить"]})]}),e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(V,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 opacity-60"}),e.jsx(B,{value:j,onChange:s=>M(s.target.value),placeholder:"Поиск по email, id, коду",className:"pl-8"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(r,{variant:u==="all"?"soft":"outline",onClick:()=>y("all"),children:"Все"}),e.jsx(r,{variant:u==="admin"?"soft":"outline",onClick:()=>y("admin"),children:"Админы"}),e.jsx(r,{variant:u==="user"?"soft":"outline",onClick:()=>y("user"),children:"Пользователи"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-xs opacity-60",children:"Сортировка:"}),e.jsxs(r,{variant:"outline",onClick:()=>T("email"),className:"text-xs",children:["Email ",m==="email"?g==="asc"?e.jsx(U,{size:14}):e.jsx(I,{size:14}):null]}),e.jsxs(r,{variant:"outline",onClick:()=>T("role"),className:"text-xs",children:["Роль ",m==="role"?g==="asc"?e.jsx(U,{size:14}):e.jsx(I,{size:14}):null]}),e.jsxs(r,{variant:"outline",onClick:()=>T("codes"),className:"text-xs",children:["Кол-во кодов ",m==="codes"?g==="asc"?e.jsx(U,{size:14}):e.jsx(I,{size:14}):null]})]}),h&&e.jsx("div",{className:"rounded-xl border border-red-300/40 bg-red-500/10 px-3 py-2 text-sm text-red-600 dark:border-red-500/20 dark:text-red-300",children:h}),e.jsx("div",{className:"grid gap-3",children:d&&o.length===0?e.jsx("div",{className:"text-sm opacity-60",children:"Загрузка пользователей…"}):P.length===0?e.jsx("div",{className:"text-sm opacity-60",children:"Ничего не найдено"}):P.map(s=>e.jsxs("div",{className:"border rounded-xl p-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ee,{size:14,className:"opacity-60"})," ",s.email]}),e.jsxs("div",{className:"mt-1 text-xs opacity-60",children:["ID: ",s.id]}),e.jsxs("div",{className:"mt-1 text-xs opacity-60",children:["Роль: ",s.role]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs(r,{variant:"outline",onClick:()=>D(s.email,`email:${s.id}`),children:[$===`email:${s.id}`?e.jsx(S,{size:14}):e.jsx(L,{size:14}),"Копировать email"]}),e.jsxs(r,{variant:"outline",onClick:()=>D(s.id,`id:${s.id}`),children:[$===`id:${s.id}`?e.jsx(S,{size:14}):e.jsx(L,{size:14}),"ID"]})]})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[s.codes.length===0&&e.jsx("span",{className:"text-xs opacity-60",children:"Кодов нет"}),s.codes.map(t=>e.jsxs("span",{className:"flex items-center gap-1 rounded-full bg-black/5 dark:bg-white/10 px-2 py-1 text-xs",children:[t,e.jsx("button",{onClick:()=>D(t,`code:${s.id}:${t}`),title:"Копировать код",className:"opacity-60 hover:opacity-100",children:$===`code:${s.id}:${t}`?e.jsx(S,{size:12}):e.jsx(L,{size:12})}),e.jsx("button",{onClick:()=>E({userId:s.id,code:t}),title:"Удалить код",className:"opacity-60 hover:opacity-100",children:e.jsx(H,{size:12})})]},t))]}),e.jsxs("div",{className:"mt-3 flex flex-col gap-2 sm:flex-row sm:items-center",children:[e.jsx(B,{value:p[s.id]||"",onChange:t=>w(l=>({...l,[s.id]:t.target.value})),onKeyDown:t=>{t.key==="Enter"&&A(s.id)},placeholder:"Код или несколько (через запятую/пробел)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(r,{onClick:()=>A(s.id),disabled:d,children:[e.jsx(Z,{size:16})," Выдать"]}),s.codes.length>0&&e.jsxs(r,{variant:"outline",onClick:()=>O(s.id,s.codes),disabled:d,children:[e.jsx(H,{size:16})," Удалить все"]})]})]})]},s.id))}),e.jsx(_,{open:!!b,title:"Удалить код?",description:b?`Код ${b.code} будет отозван.`:void 0,confirmText:"Удалить",cancelText:"Отмена",onConfirm:()=>b&&J(b.userId,b.code),onCancel:()=>E(null)})]})}function ae(){const[o,f]=i.useState([]),[d,c]=i.useState(!1),[h,x]=i.useState(null),[j,M]=i.useState(""),[u,y]=i.useState(null);i.useEffect(()=>{m()},[]);async function m(){c(!0),x(null);try{const a=await C.getLegendaryCatalog();f(a.catalog||[])}catch(a){x((a==null?void 0:a.message)||"Не удалось загрузить список кодов")}finally{c(!1)}}const z=i.useMemo(()=>{const a=j.trim().toLowerCase();return o.filter(p=>!a||p.code.toLowerCase().includes(a)||p.title.toLowerCase().includes(a)||(p.description||"").toLowerCase().includes(a))},[o,j]);async function g(a,p){try{await navigator.clipboard.writeText(a),y(p),setTimeout(()=>y(w=>w===p?null:w),1200)}catch{}}return e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm opacity-60",children:[e.jsx(K,{size:16})," Доступные к активации события"]}),e.jsxs(r,{variant:"soft",onClick:m,disabled:d,children:[e.jsx(G,{className:d?"animate-spin":"",size:16})," Обновить"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(V,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 opacity-60"}),e.jsx(B,{value:j,onChange:a=>M(a.target.value),placeholder:"Поиск по коду или названию",className:"pl-8"})]}),h&&e.jsx("div",{className:"rounded-xl border border-red-300/40 bg-red-500/10 px-3 py-2 text-sm text-red-600 dark:border-red-500/20 dark:text-red-300",children:h}),e.jsx("div",{className:"grid gap-3",children:d&&o.length===0?e.jsx("div",{className:"text-sm opacity-60",children:"Загрузка…"}):z.length===0?e.jsx("div",{className:"text-sm opacity-60",children:"Ничего не найдено"}):z.map(a=>e.jsx("div",{className:"rounded-xl border p-3",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium flex items-center gap-2",children:e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx("span",{className:"rounded-md bg-yellow-500/15 px-2 py-0.5 text-xs text-yellow-700 dark:text-yellow-300",children:a.code}),e.jsx("span",{children:a.title})]})}),a.description?e.jsx("div",{className:"mt-1 text-xs opacity-80",children:a.description}):null,e.jsxs("div",{className:"mt-1 text-[11px] opacity-60",children:["Источник: ",a.source==="db"?"Событие в БД":"Встроено"]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(r,{variant:"outline",onClick:()=>g(a.code,`code:${a.code}`),children:[u===`code:${a.code}`?e.jsx(S,{size:14}):e.jsx(L,{size:14}),"Код"]})})]})},`${a.source}:${a.code}`))})]})}export{ie as default};
