import{c as z,R as r,f as D,j as a,D as E,B as x,X as S,g as M,h as R,M as $,P as L,i as B}from"./index-Br-z90d1.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=z("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),U=i=>i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");function V({open:i,event:s,admin:w,onClose:n,onEdit:N,onDelete:y,onImagePreview:m}){var k;const[c,g]=r.useState(null),[o,p]=r.useState(null),[u,f]=r.useState(!1),[j,b]=r.useState(!1);r.useEffect(()=>{let e=!1;if(g(null),p(null),!!(s!=null&&s.chatId))return f(!0),D.getChatMessages(s.chatId,s.chatFromId??void 0,s.chatToId??void 0).then(t=>{e||g(t.messages||[])}).catch(t=>{e||p((t==null?void 0:t.message)||"Не удалось загрузить переписку")}).finally(()=>{e||f(!1)}),()=>{e=!0}},[s==null?void 0:s.chatId,s==null?void 0:s.chatFromId,s==null?void 0:s.chatToId]),r.useEffect(()=>{b(!!(s!=null&&s.chatId))},[s==null?void 0:s.chatId]);const C=r.useCallback(e=>{const t=e.match(/(https?:\/\/\S+\.(?:png|jpe?g|gif|webp)(?:\?\S*)?)/gi);return t?t.map(l=>l.trim()):[]},[]),I=r.useCallback((e,t)=>{if(!t.length)return e.trim();let l=e;return t.forEach(d=>{const h=new RegExp(`(?:\\s*Фотография:?\\s*)?${U(d)}`,"gi");l=l.replace(h," ")}),l.replace(/ {2,}/g," ").trim()},[]);return!i||!s?null:a.jsxs(E,{open:i,onClose:n,children:[a.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between gap-3 border-b border-black/10 bg-white/95 px-4 py-3 dark:border-white/10 dark:bg-neutral-900/95 rounded-t-2xl",children:[a.jsxs("div",{className:"flex items-center gap-2 text-lg font-semibold",children:[a.jsx(T,{size:18})," ",s.title]}),a.jsx(x,{variant:"ghost",onClick:n,children:a.jsx(S,{size:18})})]}),a.jsxs("div",{className:"flex max-h-[85vh] flex-col gap-3 overflow-y-auto p-4",children:[a.jsxs("div",{className:"text-sm opacity-80",children:[a.jsx(R,{className:"-mt-0.5 inline",size:14})," ",M(s.date)]}),s.imageData&&a.jsx("div",{className:"overflow-hidden rounded-2xl border border-black/10 dark:border-white/10 flex-shrink-0",children:a.jsx("img",{src:s.imageData,alt:s.title,className:"max-h-[30vh] w-full cursor-pointer object-contain",onClick:()=>m(s.imageData)})}),s.description&&a.jsx("p",{className:"text-sm leading-relaxed text-neutral-800 dark:text-neutral-200 whitespace-pre-line",children:s.description}),(k=s.tags)!=null&&k.length?a.jsx("div",{className:"flex flex-wrap gap-2",children:s.tags.map(e=>a.jsxs("span",{className:"rounded-full border border-black/10 bg-black/5 px-2 py-0.5 text-xs dark:border-white/10 dark:bg-white/10",children:["#",e==="legendary"?"легендарное":e]},e))}):null,s.chatId&&a.jsxs("div",{className:"rounded-2xl border border-emerald-500/30 bg-emerald-500/5 p-3",children:[a.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[a.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-emerald-700 dark:text-emerald-200",children:[a.jsx($,{size:16})," Переписка"]}),a.jsx(x,{variant:"ghost",className:"px-3 py-1 text-xs",onClick:()=>b(e=>!e),children:j?"Скрыть":"Показать"})]}),j?a.jsxs("div",{className:"mt-3 grid gap-2",children:[u&&a.jsx("div",{className:"text-sm text-black/60 dark:text-white/60",children:"Загрузка переписки…"}),o&&a.jsx("div",{className:"text-sm text-red-500",children:o}),!u&&!o&&a.jsx("div",{className:"flex flex-col gap-3",children:c!=null&&c.length?c.map(e=>{const t=C(e.text),l=I(e.text,t);return a.jsxs("div",{className:"rounded-2xl bg-white/80 p-3 text-sm shadow-sm dark:bg-white/5",children:[a.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 text-xs text-black/60 dark:text-white/60",children:[a.jsx("span",{className:"font-semibold text-black dark:text-white",children:e.author}),a.jsx("span",{children:e.datetime})]}),l&&a.jsx("p",{className:"mt-1 whitespace-pre-line text-sm text-black/80 dark:text-white/80",children:l}),t.length>0&&a.jsx("div",{className:"mt-2 grid gap-2",children:t.map((d,h)=>a.jsx("div",{className:"overflow-hidden rounded-2xl border",children:a.jsx("img",{src:d,alt:"Фото из переписки",className:"w-50 max-h-60 cursor-zoom-in rounded-xl object-cover",loading:"lazy",onClick:()=>m(d)})},`${e.id}-${h}`))})]},e.id)}):a.jsx("div",{className:"text-sm text-black/60 dark:text-white/60",children:"Сообщений в указанном диапазоне нет"})})]}):a.jsx("div",{className:"mt-3 text-sm text-black/60 dark:text-white/60",children:"Переписка скрыта"})]}),w&&a.jsxs("div",{className:"mt-2 flex items-center justify-end gap-2",children:[a.jsxs(x,{variant:"soft",onClick:()=>N(s),children:[a.jsx(L,{size:16})," Редактировать"]}),a.jsxs(x,{variant:"outline",onClick:()=>y(s),children:[a.jsx(B,{size:16})," Удалить"]})]})]})]})}export{V as default};
