import{c as C,R as l,f as L,j as e,D as F,B as x,X as H,g as P,h as V,M as q,i as v,P as X,k as _}from"./index-B5ZeHfn4.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=C("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=C("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),K=c=>c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");function Q({open:c,event:a,admin:I,onClose:p,onEdit:z,onDelete:E,onImagePreview:u}){var y;const[d,b]=l.useState(null),[h,f]=l.useState(null),[k,j]=l.useState(!1),[w,N]=l.useState(!1);l.useEffect(()=>{let t=!1;if(b(null),f(null),!!(a!=null&&a.chatId))return j(!0),L.getChatMessages(a.chatId,a.chatFromId??void 0,a.chatToId??void 0).then(s=>{t||b(s.messages||[])}).catch(s=>{t||f((s==null?void 0:s.message)||"Не удалось загрузить переписку")}).finally(()=>{t||j(!1)}),()=>{t=!0}},[a==null?void 0:a.chatId,a==null?void 0:a.chatFromId,a==null?void 0:a.chatToId]),l.useEffect(()=>{N(!!(a!=null&&a.chatId))},[a==null?void 0:a.chatId]);const M=l.useCallback(t=>{const s=t.match(/(https?:\/\/\S+\.(?:png|jpe?g|gif|webp)(?:\?\S*)?)/gi);return s?s.map(r=>r.trim()):[]},[]),S=l.useCallback((t,s)=>{if(!s.length)return t.trim();let r=t;return s.forEach(i=>{const g=new RegExp(`(?:\\s*Фотография:?\\s*)?${K(i)}`,"gi");r=r.replace(g," ")}),r.replace(/ {2,}/g," ").trim()},[]),m=l.useMemo(()=>["#f97316","#ec4899","#6366f1","#0ea5e9","#84cc16","#f43f5e","#14b8a6","#a855f7"],[]),$=l.useCallback(t=>{if(!t)return"#94a3b8";let s=0;for(let r=0;r<t.length;r+=1)s=s*31+t.charCodeAt(r)|0;return m[Math.abs(s)%m.length]},[m]),D=l.useCallback(t=>{if(!t)return"?";const s=t.trim().split(/\s+/).filter(Boolean);return s.length?s.length===1?s[0].slice(0,2).toUpperCase():(s[0][0]+s[s.length-1][0]).toUpperCase():"?"},[]);return!c||!a?null:e.jsxs(F,{open:c,onClose:p,children:[e.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between gap-3 border-b border-black/10 bg-white/95 px-4 py-3 dark:border-white/10 dark:bg-neutral-900/95 rounded-t-2xl",children:[e.jsxs("div",{className:"flex items-center gap-2 text-lg font-semibold",children:[e.jsx(J,{size:18})," ",a.title]}),e.jsx(x,{variant:"ghost",onClick:p,children:e.jsx(H,{size:18})})]}),e.jsxs("div",{className:"flex max-h-[85vh] flex-col gap-3 overflow-y-auto p-4",children:[e.jsxs("div",{className:"text-sm opacity-80",children:[e.jsx(V,{className:"-mt-0.5 inline",size:14})," ",P(a.date)]}),a.imageData&&e.jsx("div",{className:"overflow-hidden rounded-2xl border border-black/10 dark:border-white/10 flex-shrink-0",children:e.jsx("img",{src:a.imageData,alt:a.title,className:"max-h-[30vh] w-full cursor-pointer object-contain",onClick:()=>u(a.imageData)})}),a.description&&e.jsx("p",{className:"text-sm leading-relaxed text-neutral-800 dark:text-neutral-200 whitespace-pre-line",children:a.description}),(y=a.tags)!=null&&y.length?e.jsx("div",{className:"flex flex-wrap gap-2",children:a.tags.map(t=>e.jsxs("span",{className:"rounded-full border border-black/10 bg-black/5 px-2 py-0.5 text-xs dark:border-white/10 dark:bg-white/10",children:["#",t==="legendary"?"легендарное":t]},t))}):null,a.chatId&&e.jsxs("div",{className:"rounded-2xl border border-emerald-500/30 bg-emerald-500/5 p-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-emerald-700 dark:text-emerald-200",children:[e.jsx(q,{size:16})," Переписка"]}),e.jsx(x,{variant:"ghost",className:"px-3 py-1 text-xs",onClick:()=>N(t=>!t),children:w?"Скрыть":"Показать"})]}),w?e.jsxs("div",{className:"mt-3 grid gap-2",children:[k&&e.jsx("div",{className:"text-sm text-black/60 dark:text-white/60",children:"Загрузка переписки…"}),h&&e.jsx("div",{className:"text-sm text-red-500",children:h}),!k&&!h&&e.jsx("div",{className:"flex flex-col gap-3",children:d!=null&&d.length?d.map(t=>{const s=M(t.text),r=S(t.text,s),i="1 прикреплённое сообщение",g=r.includes(i),T=r==="Стикер",A=$(t.author),R=D(t.author),U=s.length?"border-emerald-500/20 bg-gradient-to-br from-emerald-50/90 via-white/95 to-white dark:from-emerald-500/15 dark:via-white/5 dark:to-white/0":"border-black/5 bg-white/95 dark:border-white/10 dark:bg-neutral-900/70";return e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-2xl text-xs font-semibold uppercase text-white shadow-sm ring-2 ring-white/70 dark:ring-emerald-500/40",style:{backgroundColor:A},title:t.author,children:R}),e.jsxs("div",{className:`flex-1 rounded-3xl border px-4 py-3 shadow-sm backdrop-blur-sm transition hover:shadow-md ${U}`,children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-[12px] font-medium text-black/60 dark:text-white/60",children:[e.jsx("span",{className:"text-black dark:text-white",children:t.author}),e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-black/5 px-2 py-0.5 text-[11px] font-normal text-black/60 dark:bg-white/10 dark:text-white/70",children:[e.jsx(G,{size:12,className:"opacity-70"}),v(t.datetime)]})]}),r&&e.jsx("p",{className:`mt-2 whitespace-pre-line text-[15px] leading-relaxed ${T?"text-black/40 dark:text-white/40 italic":"text-black/80 dark:text-white/80"}`,children:g?r.split(i).map((o,n,B)=>e.jsxs(l.Fragment,{children:[o,n<B.length-1&&e.jsx("span",{className:"text-black/40 dark:text-white/40",children:i})]},`${t.id}-chunk-${n}`)):r}),s.length>0&&e.jsx("div",{className:"mt-3 grid gap-3 sm:grid-cols-2",children:s.map((o,n)=>e.jsxs("button",{type:"button",className:"group relative overflow-hidden rounded-2xl border border-emerald-500/20 bg-black/5 shadow-inner transition hover:border-emerald-500/40 focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500/50",onClick:()=>u(o),children:[e.jsx("img",{src:o,alt:"Фото из переписки",className:"h-44 w-full cursor-zoom-in object-cover transition duration-300 group-hover:scale-[1.03]",loading:"lazy"}),e.jsx("span",{className:"pointer-events-none absolute bottom-2 right-2 rounded-full bg-black/70 px-2 py-0.5 text-xs text-white opacity-0 transition group-hover:opacity-100",children:"Открыть"})]},`${t.id}-${n}`))})]})]},t.id)}):e.jsx("div",{className:"text-sm text-black/60 dark:text-white/60",children:"Сообщений в указанном диапазоне нет"})})]}):e.jsx("div",{className:"mt-3 text-sm text-black/60 dark:text-white/60",children:"Переписка скрыта"})]}),I&&e.jsxs("div",{className:"mt-2 flex items-center justify-end gap-2",children:[e.jsxs(x,{variant:"soft",onClick:()=>z(a),children:[e.jsx(X,{size:16})," Редактировать"]}),e.jsxs(x,{variant:"outline",onClick:()=>E(a),children:[e.jsx(_,{size:16})," Удалить"]})]})]})]})}export{Q as default};
