import{c as N,r as i,j as e,D as W,B as o,U as Q,S as V,a as X,h as b,i as H,I,g as P,k as Y,l as Z}from"./index-BofiGu4a.js";import{C as U}from"./chevron-down-CWs5Asrl.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S=N("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=N("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=N("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=N("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=N("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=N("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);function ie({open:d,onClose:p}){const[r,n]=i.useState("users");return i.useEffect(()=>{d&&n("users")},[d]),e.jsx(W,{open:d,onClose:p,children:e.jsxs("div",{className:"p-0 flex max-h-[85vh] flex-col",children:[e.jsxs("div",{className:"border-b px-4 pt-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 pb-3",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(ee,{size:18})," Админ-панель"]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(o,{variant:"outline",onClick:p,children:"Закрыть"})})]}),e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"flex gap-2 rounded-xl bg-black/5 p-1 dark:bg-white/10",children:[e.jsxs(F,{active:r==="users",onClick:()=>n("users"),children:[e.jsx(Q,{size:16})," Пользователи"]}),e.jsxs(F,{active:r==="legendary",onClick:()=>n("legendary"),children:[e.jsx(V,{size:16})," Легендарные события"]})]})})]}),e.jsx("div",{className:"min-h-0 flex-1 overflow-y-auto p-4",children:r==="users"?e.jsx(se,{}):e.jsx(ae,{})})]})})}function F({active:d,onClick:p,children:r}){return e.jsx("button",{onClick:p,className:X("flex items-center gap-2 rounded-lg px-3 py-1.5 text-sm transition",d?"bg-white shadow dark:bg-neutral-800":"hover:bg-black/10 dark:hover:bg-white/20"),children:r})}function se(){const[d,p]=i.useState([]),[r,n]=i.useState(!1),[C,x]=i.useState(null),[u,$]=i.useState(""),[f,v]=i.useState("all"),[m,z]=i.useState("email"),[j,a]=i.useState("asc"),[h,w]=i.useState({}),[M,R]=i.useState(null),[y,D]=i.useState(null);i.useEffect(()=>{k()},[]);async function k(){x(null),n(!0);try{const s=await b.getUsers();p(s.users)}catch(s){x((s==null?void 0:s.message)||"Не удалось загрузить пользователей")}finally{n(!1)}}async function q(s){const t=(h[s]||"").trim();if(!t)return;const l=Array.from(new Set(t.split(/[\s,;]+/g).map(c=>c.trim()).filter(Boolean)));if(l.length!==0){n(!0),x(null);try{for(const c of l)await b.grantLegendary(s,c);w(c=>({...c,[s]:""})),await k()}catch(c){x((c==null?void 0:c.message)||"Не удалось выдать код(ы)")}finally{n(!1)}}}async function G(s,t){n(!0),x(null);try{await b.revokeLegendary(s,t),await k()}catch(l){x((l==null?void 0:l.message)||"Не удалось отозвать код")}finally{n(!1),D(null)}}async function J(s,t){if(t.length!==0){n(!0),x(null);try{for(const l of t)await b.revokeLegendary(s,l);await k()}catch(l){x((l==null?void 0:l.message)||"Не удалось отозвать коды")}finally{n(!1)}}}function E(s){m===s?a(t=>t==="asc"?"desc":"asc"):(z(s),a("asc"))}const A=i.useMemo(()=>{const s=u.trim().toLowerCase();let t=d.filter(l=>{if(f!=="all"&&l.role!==f)return!1;if(!s)return!0;const c=l.email.toLowerCase().includes(s),g=l.codes.some(O=>O.toLowerCase().includes(s));return c||g||l.id.toLowerCase().includes(s)});return t.sort((l,c)=>{let g=0;return m==="email"?g=l.email.localeCompare(c.email):m==="role"?g=l.role.localeCompare(c.role):m==="codes"&&(g=l.codes.length-c.codes.length),j==="asc"?g:-g}),t},[d,u,f,m,j]);async function T(s,t){try{await navigator.clipboard.writeText(s),R(t),setTimeout(()=>R(l=>l===t?null:l),1200)}catch{}}return e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm opacity-60",children:[e.jsx(Q,{size:16})," Управление пользователями"]}),e.jsxs(o,{variant:"soft",onClick:k,disabled:r,children:[e.jsx(K,{className:r?"animate-spin":"",size:16})," Обновить"]})]}),e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(H,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 opacity-60"}),e.jsx(I,{value:u,onChange:s=>$(s.target.value),placeholder:"Поиск по email, id, коду",className:"pl-8"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{variant:f==="all"?"soft":"outline",onClick:()=>v("all"),children:"Все"}),e.jsx(o,{variant:f==="admin"?"soft":"outline",onClick:()=>v("admin"),children:"Админы"}),e.jsx(o,{variant:f==="user"?"soft":"outline",onClick:()=>v("user"),children:"Пользователи"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-xs opacity-60",children:"Сортировка:"}),e.jsxs(o,{variant:"outline",onClick:()=>E("email"),className:"text-xs",children:["Email ",m==="email"?j==="asc"?e.jsx(B,{size:14}):e.jsx(U,{size:14}):null]}),e.jsxs(o,{variant:"outline",onClick:()=>E("role"),className:"text-xs",children:["Роль ",m==="role"?j==="asc"?e.jsx(B,{size:14}):e.jsx(U,{size:14}):null]}),e.jsxs(o,{variant:"outline",onClick:()=>E("codes"),className:"text-xs",children:["Кол-во кодов ",m==="codes"?j==="asc"?e.jsx(B,{size:14}):e.jsx(U,{size:14}):null]})]}),C&&e.jsx("div",{className:"rounded-xl border border-red-300/40 bg-red-500/10 px-3 py-2 text-sm text-red-600 dark:border-red-500/20 dark:text-red-300",children:C}),e.jsx("div",{className:"grid gap-3",children:r&&d.length===0?e.jsx("div",{className:"text-sm opacity-60",children:"Загрузка пользователей…"}):A.length===0?e.jsx("div",{className:"text-sm opacity-60",children:"Ничего не найдено"}):A.map(s=>e.jsxs("div",{className:"border rounded-xl p-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(_,{size:14,className:"opacity-60"})," ",s.email]}),e.jsxs("div",{className:"mt-1 text-xs opacity-60",children:["ID: ",s.id]}),e.jsxs("div",{className:"mt-1 text-xs opacity-60",children:["Роль: ",s.role]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs(o,{variant:"outline",onClick:()=>T(s.email,`email:${s.id}`),children:[M===`email:${s.id}`?e.jsx(S,{size:14}):e.jsx(L,{size:14}),"Копировать email"]}),e.jsxs(o,{variant:"outline",onClick:()=>T(s.id,`id:${s.id}`),children:[M===`id:${s.id}`?e.jsx(S,{size:14}):e.jsx(L,{size:14}),"ID"]})]})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[s.codes.length===0&&e.jsx("span",{className:"text-xs opacity-60",children:"Кодов нет"}),s.codes.map(t=>e.jsxs("span",{className:"flex items-center gap-1 rounded-full bg-black/5 dark:bg-white/10 px-2 py-1 text-xs",children:[t,e.jsx("button",{onClick:()=>T(t,`code:${s.id}:${t}`),title:"Копировать код",className:"opacity-60 hover:opacity-100",children:M===`code:${s.id}:${t}`?e.jsx(S,{size:12}):e.jsx(L,{size:12})}),e.jsx("button",{onClick:()=>D({userId:s.id,code:t}),title:"Удалить код",className:"opacity-60 hover:opacity-100",children:e.jsx(P,{size:12})})]},t))]}),e.jsxs("div",{className:"mt-3 flex flex-col gap-2 sm:flex-row sm:items-center",children:[e.jsx(I,{value:h[s.id]||"",onChange:t=>w(l=>({...l,[s.id]:t.target.value})),onKeyDown:t=>{t.key==="Enter"&&q(s.id)},placeholder:"Код или несколько (через запятую/пробел)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{onClick:()=>q(s.id),disabled:r,children:[e.jsx(Y,{size:16})," Выдать"]}),s.codes.length>0&&e.jsxs(o,{variant:"outline",onClick:()=>J(s.id,s.codes),disabled:r,children:[e.jsx(P,{size:16})," Удалить все"]})]})]})]},s.id))}),e.jsx(Z,{open:!!y,title:"Удалить код?",description:y?`Код ${y.code} будет отозван.`:void 0,confirmText:"Удалить",cancelText:"Отмена",onConfirm:()=>y&&G(y.userId,y.code),onCancel:()=>D(null)})]})}function ae(){const[d,p]=i.useState([]),[r,n]=i.useState(!1),[C,x]=i.useState(null),[u,$]=i.useState(""),[f,v]=i.useState(null);i.useEffect(()=>{m()},[]);async function m(){n(!0),x(null);try{const a=await b.getLegendaryCatalog();p(a.catalog||[])}catch(a){x((a==null?void 0:a.message)||"Не удалось загрузить список кодов")}finally{n(!1)}}const z=i.useMemo(()=>{const a=u.trim().toLowerCase();return d.filter(h=>!a||h.code.toLowerCase().includes(a)||h.title.toLowerCase().includes(a)||(h.description||"").toLowerCase().includes(a))},[d,u]);async function j(a,h){try{await navigator.clipboard.writeText(a),v(h),setTimeout(()=>v(w=>w===h?null:w),1200)}catch{}}return e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm opacity-60",children:[e.jsx(V,{size:16})," Доступные к активации события"]}),e.jsxs(o,{variant:"soft",onClick:m,disabled:r,children:[e.jsx(K,{className:r?"animate-spin":"",size:16})," Обновить"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(H,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 opacity-60"}),e.jsx(I,{value:u,onChange:a=>$(a.target.value),placeholder:"Поиск по коду или названию",className:"pl-8"})]}),C&&e.jsx("div",{className:"rounded-xl border border-red-300/40 bg-red-500/10 px-3 py-2 text-sm text-red-600 dark:border-red-500/20 dark:text-red-300",children:C}),e.jsx("div",{className:"grid gap-3",children:r&&d.length===0?e.jsx("div",{className:"text-sm opacity-60",children:"Загрузка…"}):z.length===0?e.jsx("div",{className:"text-sm opacity-60",children:"Ничего не найдено"}):z.map(a=>e.jsx("div",{className:"rounded-xl border p-3",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium flex items-center gap-2",children:e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx("span",{className:"rounded-md bg-yellow-500/15 px-2 py-0.5 text-xs text-yellow-700 dark:text-yellow-300",children:a.code}),e.jsx("span",{children:a.title})]})}),a.description?e.jsx("div",{className:"mt-1 text-xs opacity-80",children:a.description}):null,e.jsxs("div",{className:"mt-1 text-[11px] opacity-60",children:["Источник: ",a.source==="db"?"Событие в БД":"Встроено"]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(o,{variant:"outline",onClick:()=>j(a.code,`code:${a.code}`),children:[f===`code:${a.code}`?e.jsx(S,{size:14}):e.jsx(L,{size:14}),"Код"]})})]})},`${a.source}:${a.code}`))})]})}export{ie as default};
