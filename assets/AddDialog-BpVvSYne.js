import{c as q,r,j as e,a as j,C as G,b as J,T as E,d as K,R as U,B as v,I as y,e as X,f as Q,g as O,X as L,S as Z,u as ee,D as te}from"./index-BH3WMTMg.js";import{C as W}from"./chevron-down-BIb2rMth.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=q("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=q("WandSparkles",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]),re=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],oe=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"];function H(t){const l=t.getFullYear(),g=String(t.getMonth()+1).padStart(2,"0"),d=String(t.getDate()).padStart(2,"0");return`${l}-${g}-${d}`}function ne(t,l){let d=new Date(t,l,1).getDay()-1;d<0&&(d=6);const m=new Date(t,l,1-d),u=[];for(let h=0;h<42;h++){const x=new Date(m);x.setDate(m.getDate()+h),u.push({d:x,inMonth:x.getMonth()===l})}return u}function de({value:t,onChange:l,className:g}){const[d,m]=r.useState(!1),u=r.useMemo(()=>{const s=new Date(t);return isNaN(s.getTime())?new Date:s},[t]),[h,x]=r.useState(u.getFullYear()),[f,c]=r.useState(u.getMonth()),p=r.useRef(null);r.useEffect(()=>{d&&(x(u.getFullYear()),c(u.getMonth()))},[d,u]),r.useEffect(()=>{if(!d)return;function s(n){p.current&&(p.current.contains(n.target)||m(!1))}function o(n){n.key==="Escape"&&m(!1)}return document.addEventListener("mousedown",s),document.addEventListener("keydown",o),()=>{document.removeEventListener("mousedown",s),document.removeEventListener("keydown",o)}},[d]);const C=r.useMemo(()=>ne(h,f),[h,f]),D=H(new Date),w=new Date().getFullYear(),I=r.useMemo(()=>{const o=w+20,n=[];for(let b=1900;b<=o;b++)n.push(b);return n},[w]);return e.jsxs("div",{className:j("relative",g),ref:p,children:[e.jsx("button",{type:"button",onClick:()=>m(s=>!s),className:j("w-full rounded-xl border border-black/10 dark:border-white/10 bg-white/80 dark:bg-white/5 px-3 py-2 text-sm text-left","focus:outline-hidden focus:ring-2 focus:ring-indigo-400/60"),"aria-haspopup":"dialog","aria-expanded":d,children:new Date(t).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"})}),d&&e.jsxs("div",{className:"absolute z-10 mt-2 w-88 rounded-2xl border border-black/10 bg-white/95 p-3 shadow-2xl backdrop-blur-sm dark:border-white/10 dark:bg-neutral-900/95",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 px-1 pb-2",children:[e.jsx("button",{type:"button",className:"rounded-xl p-1.5 hover:bg-black/5 dark:hover:bg-white/10",onClick:()=>{let s=f-1,o=h;s<0&&(s=11,o-=1),c(s),x(o)},"aria-label":"Предыдущий месяц",children:e.jsx(G,{size:18})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("select",{className:j("appearance-none rounded-xl border border-black/10 bg-white px-3 py-2 pr-8 text-sm text-neutral-900 shadow-xs","focus:outline-hidden focus:ring-2 focus:ring-indigo-400/60","dark:border-white/10 dark:bg-neutral-900 dark:text-white"),value:f,onChange:s=>c(Number(s.target.value)),children:re.map((s,o)=>e.jsx("option",{value:o,children:s},s))}),e.jsx(W,{size:16,className:"pointer-events-none absolute right-2 top-1/2 -translate-y-1/2 text-neutral-500 dark:text-neutral-400"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{className:j("appearance-none rounded-xl border border-black/10 bg-white px-3 py-2 pr-8 text-sm text-neutral-900 shadow-xs","focus:outline-hidden focus:ring-2 focus:ring-indigo-400/60","dark:border-white/10 dark:bg-neutral-900 dark:text-white"),value:h,onChange:s=>x(Number(s.target.value)),children:I.map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsx(W,{size:16,className:"pointer-events-none absolute right-2 top-1/2 -translate-y-1/2 text-neutral-500 dark:text-neutral-400"})]})]}),e.jsx("button",{type:"button",className:"rounded-xl p-1.5 hover:bg-black/5 dark:hover:bg-white/10",onClick:()=>{let s=f+1,o=h;s>11&&(s=0,o+=1),c(s),x(o)},"aria-label":"Следующий месяц",children:e.jsx(J,{size:18})})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 px-1 text-center text-xs opacity-70 select-none",children:oe.map(s=>e.jsx("div",{className:"py-1",children:s},s))}),e.jsx("div",{className:"mt-1 grid grid-cols-7 gap-1",children:C.map(({d:s,inMonth:o})=>{const n=H(s),b=n===t,S=n===D;return e.jsxs(E,{delay:0,children:[e.jsx(E.Trigger,{asChild:!0,children:e.jsx("button",{type:"button",onClick:()=>{l(n),m(!1)},className:j("h-9 rounded-xl text-sm transition",o?"":"opacity-50",b?"bg-indigo-500 text-white shadow-sm":"hover:bg-black/5 dark:hover:bg-white/10"),"aria-current":S?"date":void 0,children:s.getDate()})}),e.jsxs(K,{showArrow:!0,className:"text-xs text-center",children:[e.jsx(E.Arrow,{}),s.toLocaleDateString("ru-RU")]})]},n+String(o))})}),e.jsxs("div",{className:"mt-3 flex items-center justify-between px-1",children:[e.jsx("button",{type:"button",className:"text-xs rounded-lg px-2 py-1 hover:bg-black/5 dark:hover:bg-white/10",onClick:()=>{const s=new Date;x(s.getFullYear()),c(s.getMonth())},children:"Сегодня"}),e.jsx("button",{type:"button",className:"text-xs rounded-lg px-2 py-1 hover:bg-black/5 dark:hover:bg-white/10",onClick:()=>m(!1),children:"Закрыть"})]})]})]})}function ce({initial:t,onSubmit:l,onCancel:g}){const[d,m]=r.useState((t==null?void 0:t.date)||new Date().toISOString().slice(0,10)),[u,h]=r.useState((t==null?void 0:t.title)||""),[x,f]=r.useState((t==null?void 0:t.description)||""),[c,p]=r.useState((t==null?void 0:t.tags)||[]),[C,D]=r.useState(""),[w,I]=r.useState((t==null?void 0:t.color)||""),[s,o]=r.useState(t==null?void 0:t.imageData),[n,b]=r.useState(!!(t!=null&&t.code)),[S,_]=r.useState((t==null?void 0:t.code)||""),[T,$]=r.useState((t==null?void 0:t.chatId)||""),[M,B]=r.useState((t==null?void 0:t.chatFromId)!==void 0&&(t==null?void 0:t.chatFromId)!==null?String(t.chatFromId):""),[z,P]=r.useState((t==null?void 0:t.chatToId)!==void 0&&(t==null?void 0:t.chatToId)!==null?String(t.chatToId):"");U.useEffect(()=>{n?c.includes("legendary")||p(a=>[...a,"legendary"]):c.includes("legendary")&&p(a=>a.filter(i=>i!=="legendary"))},[n]);function R(){const a=C.trim();a&&(c.includes(a)||p([...c,a]),D(""))}function V(a){var N;const i=(N=a.target.files)==null?void 0:N[0];if(!i)return;if(!i.type.startsWith("image/"))return alert("Выберите изображение");const k=new FileReader;k.onload=()=>o(String(k.result)),k.readAsDataURL(i)}return U.useEffect(()=>{function a(i){var N;const k=(N=i.clipboardData)==null?void 0:N.items;if(k){for(const Y of k)if(Y.type.startsWith("image/")){const A=Y.getAsFile();if(A){i.preventDefault();const F=new FileReader;F.onload=()=>o(String(F.result)),F.readAsDataURL(A)}break}}}return window.addEventListener("paste",a),()=>window.removeEventListener("paste",a)},[]),e.jsxs("form",{onSubmit:a=>{a.preventDefault();const i={id:(t==null?void 0:t.id)||ee(),date:d,title:u.trim()||"Без названия",description:x.trim(),tags:c,color:w||void 0,imageData:s,...n?{code:S.trim().toUpperCase()}:{},...T.trim()?{chatId:T.trim(),chatFromId:M?Number(M):void 0,chatToId:z?Number(z):void 0}:{chatId:void 0,chatFromId:void 0,chatToId:void 0}};l(i)},className:"flex min-h-0 flex-1 flex-col",children:[e.jsxs("div",{className:"grid max-h-[60vh] gap-3 overflow-y-auto pr-1",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-black/60 dark:text-white/60",children:"Тип события"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{type:"button",variant:n?"soft":"primary",onClick:()=>b(!1),children:"Обычное"}),e.jsx(v,{type:"button",variant:n?"primary":"soft",onClick:()=>b(!0),children:"Легендарное"})]})]}),n&&e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-black/60 dark:text-white/60",children:"Код"}),e.jsx(y,{value:S,onChange:a=>_(a.target.value),required:!0})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-black/60 dark:text-white/60",children:"Дата"}),e.jsx("input",{type:"date",value:d,onChange:()=>{},required:!0,className:"sr-only pointer-events-none opacity-0 absolute -z-10",tabIndex:-1,readOnly:!0}),e.jsx(de,{value:d,onChange:m})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-black/60 dark:text-white/60",children:"Заголовок"}),e.jsx(y,{value:u,onChange:a=>h(a.target.value),placeholder:"Например: Переезд в новый город"})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-black/60 dark:text-white/60",children:"Описание"}),e.jsx(X,{rows:4,value:x,onChange:a=>f(a.target.value),placeholder:"Короткая история/заметки"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-xs text-black/60 dark:text-white/60",children:"Переписка (chatId и диапазон сообщений)"}),e.jsxs("div",{className:"grid gap-2 sm:grid-cols-[1fr_140px_140px] sm:items-center sm:gap-3",children:[e.jsx(y,{value:T,onChange:a=>$(a.target.value),placeholder:"Например: samir","aria-label":"ID чата"}),e.jsx(y,{type:"number",value:M,onChange:a=>B(a.target.value),placeholder:"Сообщение от",min:0}),e.jsx(y,{type:"number",value:z,onChange:a=>P(a.target.value),placeholder:"Сообщение до",min:0})]}),e.jsx("p",{className:"text-xs text-black/50 dark:text-white/50",children:"Укажите chatId (имя JSON-файла без .json) и диапазон ID сообщений, который нужно показать в карточке."})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-xs text-black/60 dark:text-white/60",children:"Теги"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{value:C,onChange:a=>D(a.target.value),placeholder:"Добавить тег",onKeyDown:a=>a.key==="Enter"&&(a.preventDefault(),R())}),e.jsxs(v,{variant:"soft",onClick:R,type:"button",children:[e.jsx(se,{size:16})," Добавить"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 pt-1",children:c.map(a=>e.jsx(Q,{label:a,onClick:()=>a==="legendary"&&n?void 0:p(c.filter(i=>i!==a))},a))})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx("label",{className:"text-xs text-black/60 dark:text-white/60",children:"Цвет акцента"}),e.jsx("div",{className:"flex flex-wrap items-center gap-3",children:["#60a5fa","#34d399","#f472b6","#fb923c","#a78bfa","#fbbf24"].map(a=>e.jsx("button",{type:"button",onClick:()=>I(a),className:j("h-6 w-6 rounded-full border border-black/20 dark:border-white/10",w===a&&"ring-2 ring-offset-2 ring-indigo-400"),style:{background:a},"aria-label":`Выбрать цвет ${a}`},a))})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("label",{className:"text-xs text-black/60 dark:text-white/60 flex items-center gap-2",children:[e.jsx(O,{size:16})," Фото (необязательно, 1 шт; можно вставить из буфера обмена)"]}),e.jsxs("div",{className:"flex flex-col items-start gap-2",children:[e.jsxs("label",{className:j("relative flex cursor-pointer items-center justify-center rounded-xl border-2 border-dashed border-indigo-300/60 bg-white/60 px-4 py-4 text-sm font-medium transition hover:bg-indigo-50 dark:bg-white/10 dark:hover:bg-indigo-950/20",s&&"border-solid border-indigo-400 bg-indigo-50/60 dark:bg-indigo-900/30"),style:{minHeight:120,minWidth:180,width:"100%",maxWidth:320},children:[s?e.jsx("img",{src:s,alt:"Превью",className:"max-h-28 max-w-full object-contain rounded-lg shadow-sm"}):e.jsxs("div",{className:"flex flex-col items-center justify-center w-full h-full gap-2 py-2 text-indigo-500 dark:text-indigo-300",children:[e.jsx(O,{size:32}),e.jsx("span",{className:"text-xs opacity-70",children:"Выбрать изображение"})]}),e.jsx("input",{type:"file",accept:"image/*",onChange:V,className:"absolute inset-0 h-full w-full opacity-0 cursor-pointer",tabIndex:-1,"aria-label":"Выбрать изображение"})]}),s&&e.jsxs(v,{variant:"outline",className:"mt-1",onClick:()=>o(void 0),type:"button",children:[e.jsx(L,{size:14})," Удалить фото"]})]})]})]}),e.jsxs("div",{className:"sticky bottom-0 -mx-4 mt-3 flex justify-end gap-2 border-t border-black/10 bg-white/90 px-4 py-3 backdrop-blur-sm dark:border-white/10 dark:bg-neutral-900/90 rounded-b-2xl",children:[e.jsxs(v,{variant:"outline",onClick:g,type:"button",children:[e.jsx(L,{size:16})," Отмена"]}),e.jsxs(v,{type:"submit",children:[e.jsx(Z,{size:16})," Сохранить"]})]})]})}function ie({open:t,initial:l,onClose:g,onSubmit:d}){return e.jsxs(te,{open:t,onClose:g,children:[e.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between gap-3 border-b border-black/10 bg-white/95 px-4 py-3 dark:border-white/10 dark:bg-neutral-900/95 rounded-t-2xl",children:[e.jsxs("div",{className:"flex items-center gap-2 text-lg font-semibold",children:[e.jsx(ae,{size:18})," ",l?"Редактировать событие":"Новое событие"]}),e.jsx(v,{variant:"ghost",onClick:g,children:e.jsx(L,{size:18})})]}),e.jsx("div",{className:"px-4",children:e.jsx(ce,{initial:l||void 0,onCancel:g,onSubmit:d})})]})}export{ie as default};
